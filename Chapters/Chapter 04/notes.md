#Chapter 4: Notes

## A Crash Course in x86 Disassembly

- **Three Coding Levels in Malware Analysis**
  - Malware authors create programs at the high-level language level.
  - Malware authors use a compiler to generate machine code to be run by the CPU.
  - Reverse Engineers use a disassembler to generate assembly code.



## Six Different Levels of Abstraction

- **Level 01: Hardware**
  - The only physical level
  - Consists of electrical circuits that implement combinations of logical operators.
  - Cannot be easily manipulated by software


- **Level 02: Microcode**
  - Also known as firmware.
  - Operates only on the exact circuitry for which it was designed.
  - We usually don’t worry about the microcode when it comes to malware.


- **Level 03: Machine code**
  - Uses opcodes, hexadecimal digits that tell the processor what you want it to do.
  - Created when compiling a computer program written in a high-level language.


- **Level 04: Low-level languages**
  - Human-readable version of a computer architecture’s instruction set.
  - The most common low-level language is assembly language.
  - A disassembler generates low-level language text from machine code.
  - Many different dialects of assembly language exist.


- **Level 05: High-level languages**
  - Most computer programmers operate at or above this level.
  - Provides strong abstraction from the machine level.
  - Includes C, C++, and others.
  - Typically turned into machine code by a compiler.


- **Level 06: Interpreted languages**
  - Highest level of abstraction.
  - Includes C#, Perl, .NET, and Java.
  - Code at this level is not compiled into machine code; instead, it is translated into bytecode.
  - Bytecode is an intermediate representation that is specific to the programming language.
  - Bytecode runs in an interpreter, a program that translates bytecode into machine code on the fly.
  - It can handle errors and memory management on its own, independent of the OS.



## Reverse-Engineering

- **Binary reversing**
  - Malware is typically stored in binary form at the machine code level.
  - We use a disassemble to convert the machine code to assembly language.


- **Assembly language**
  - Each assembly dialect is typically used to program a single family of microprocessors
  - Common architecture dialects: x86, x64, SPARC, PowerPC, MIPS, and ARM
  - x86, also known as Intel IA-32, is the most common architecture for PC's



## x86 Architecture

- **Components**
  - The internals of the x86 architecture follows the Von Neumann architecture.
  - It contains three essential hardware components.
  - The central processing unit (CPU) executes code.
  - The main memory of the system (RAM) stores all data and code.
  - The I/O system interfaces with devices such as hard drives, keyboards, and monitors.


- **The CPU**
  - The CPU contains several components.
  - The control unit gets instructions to execute from RAM using a register (EIP)
  - Registers are the CPU’s basic data storage units.
  - The ALU executes an instruction and places the results in registers or memory.
  - The process of fetching and executing instructions is repeated as a program runs.


- **Main Memory**
  - Can be divided into four major sections.
  - Data contains values that are put in place when a program is initially loaded.
  - Code includes the instructions fetched by the CPU to execute.
  - Heap is used for dynamic memory during program execution.
  - Stack is used for local variables and function parameters, and to help control program flow.



## x86 Instructions

- **Instructions**
  - The building blocks of assembly programs.
  - Made of a mnemonic and zero or more operands.
  - the mnemonic is a word that identifies the instruction to execute, such as ```mov```
  - Operands are typically used to identify information used by the instruction.


- **Instruction Format**

  - ```mov ecx, 0x42```
  - Move the ASCII character 'A' into the ecx register.

| Mnemonic | Dest Operand | Src Operand |
|----------|--------------|-------------|
| mov      | ecx          | 0x42        |



## Opcodes and Endianness









#Chapter 5: Notes

## IDA Pro

- **Interactive Disassembler Professional (IDA Pro)**
  - Extremely powerful disassembler distributed by Hex-Rays.
  - Performs tasks such as function discovery, stack analysis, local variable identification, and much more
  - Includes extensive code signatures within its Fast Library Identification and Recognition Technology (FLIRT)
  - Robust support for plug-ins, so you can write your own extensions or leverage the work of others.
  - Two versions of IDA Pro are commercially available (standard and advanced).
  - The advanced version supports many more processors than the standard version, most notably x64.
  - Additional Resource: "The IDA Pro Book: The Unofficial Guide to the World’s Most Popular Disassembler, 2nd Edition"

- **Loading an Executable**
  - Upon loading a binary, IDA Pro will try to recognize the file’s format and processor architecture.
  - Unless you are analyzing cell phone malware, you won’t need to modify the processor type often.
  - When loading a file, IDA maps the file into memory as if it had been loaded by the operating system loader.

- **Loading a file as a Binary File**
  - Sometimes malware appends shellcode, additional data, etc to legitimate PE files
  - On occasion, this extra data won’t be loaded into memory when the malware is run by Windows or loaded into IDA Pro.
  - To addres this, you can choose to have IDA disassemble the file as a raw binary by choosing the Binary File option.
  - When you are loading a raw file containing shellcode, you should choose to load the file as a binary file and disassemble it.

- **PE File Rebasing**
  - PE files are compiled to load at a preferred base address in memory.
  - If it can’t load at it's preferred address (address is taken), the loader will perform an operation known as rebasing.
  - This happens often with DLLs, since they are often loaded at locations that differ from their preferred address.
  - If you encounter a DLL loaded into a process different from what you see in IDA Pro, it could be the result of being rebased.
  - When this occurs, check the Manual Load checkbox and specify the new virtual base address in which to load the file.



## IDA Pro Interface

- **Interface Modes**
  - After you load a program into IDA Pro, you will see the disassembly window.
  - This will be your primary space for manipulating and analyzing binaries, and it’s where the assembly code resides.
  - You can display the disassembly window in one of two modes: graph (the default) and text.
  - To switch between modes, press the spacebar.

- **Graph Mode**
  - By default, IDA Pro excludes certain information that can be useful, such as line numbers and operation codes.
  - To change these options, select Options -> General, and then select Line prefixes and set the Number of Opcode Bytes to 6
  - Since most instructions contain 6 or fewer bytes, this allows you to see memory locations and opcode values for each instruction.
  - In graph mode, the color and direction of the arrows help show the program’s flow during analysis.
  - The arrow’s color tells you whether the path is based on a particular decision having been made.
  - Red Arrow - Conditional jump is not taken.
  - Green Arrow -  Conditional jump is taken.
  - Blue Arrow - Unconditional jump.
  - Upward Arrows - Indicate a loop.
  - Highlighting text in graph mode highlights every instance of that text in the disassembly window.

- **Text Mode**
  - Text mode of the disassembly window is a more traditional view.
  - You must use text mode to view data regions of a binary.
  - It displays the memory address and section name in which the opcodes will reside in memory.
  - Functions include the stack layout and comments (beginning with a semicolon) that are automatically added by IDA Pro
  - The left portion of the text-mode display is known as the arrows window and shows the program’s nonlinear flow.
  - Solid Line - Unconditional jumps.
  - Dashed Line - Conditional jumps.
  - Upward Arrows - Indicate a loop.
  - For hints in reading assembly, select Options -> General, and then check the Auto comments checkbox.



## Useful Windows for Analysis

- **Functions Window**
  - Lists all functions in the executable and shows the length of each.
  - You can sort by function length and filter for large, complicated functions.
  - This window also associates flags with each function (F, L, S, and so on)
    - L: Library Functions
    - F: Far Function
    - S: Static Function
  - The L flag can save you time during analysis, because you can identify and skip these compiler-generated functions.

- **Names Window**
  - Lists every address with a name, including functions, named code, named data, and strings.

- **Strings Window**
  - Shows all strings in the binary.
  - By default, this list shows only ASCII strings longer than five characters.
  - You can change this by right-clicking in the Strings window and selecting Setup.

- **Imports Window**
  - Lists all imports for a file.

- **Exports Window**
  - Lists all the exported functions for a file. 
  - This window is useful when you’re analyzing DLLs.

- **Structures Window**
  - Lists the layout of all active data structures. 
  - The window also provides you the ability to create your own data structures for use as memory layout templates.


